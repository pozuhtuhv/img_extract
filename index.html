<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>IMG SRC 추출 → 공백 없는 스택 변환</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 180px; margin-bottom: 10px; }
    button { padding: 10px 16px; margin: 4px 8px 16px 0; cursor: pointer; }
    label { display:inline-flex; align-items:center; gap:8px; margin: 0 16px 0 0; }
    .code-box {
      background:#f6f6f6; border:1px solid #ccc; padding:10px;
      white-space:pre-wrap; word-break:break-all; margin-bottom: 16px;
    }
    /* 미리보기: 페이지 맨 아래 */
    .stack-preview {
      text-align:center; max-width:1000px; margin: 24px auto 0;
      line-height:0; font-size:0;
    }
    .stack-preview img {
      width:100%; height:auto; display:block; margin:0; padding:0; border:0; vertical-align:top;
    }
  </style>
</head>
<body>
  <h2>HTML IMG SRC 추출 → 스택 코드 생성</h2>

  <textarea id="htmlInput" placeholder="HTML 코드를 붙여넣으세요 (여기서 img src만 추출합니다)"></textarea><br/>

  <!-- 옵션: 출력 시 <img> style 제거 -->
  <div style="margin: 6px 0 10px 0;">
    <label>
      <input type="checkbox" id="stripStyle" />
      출력 코드에서 &lt;img&gt;의 style 속성 제거
    </label>
  </div>

  <button onclick="run()">추출 & 코드생성</button>
  <button onclick="copyCode()">코드 복사</button>

  <!-- 복사용 코드 출력 (위) -->
  <div id="codeOutput" class="code-box"></div>

  <!-- 미리보기 (맨 아래) -->
  <div id="preview"></div>

<script>
function run() {
  const raw = document.getElementById('htmlInput').value || '';
  const stripStyles = document.getElementById('stripStyle').checked;

  // HTML 파싱
  const parser = new DOMParser();
  const doc = parser.parseFromString(raw, 'text/html');

  // 1) IMG src 추출
  const urls = Array.from(doc.querySelectorAll('img[src]'))
    .map(el => el.getAttribute('src'));

  // 2) YouTube iframe 원문 보존 추출
  const youtubeIframes = Array.from(doc.querySelectorAll('iframe[src]'))
    .filter(el => /(?:youtube\.com|youtu\.be)/i.test(el.getAttribute('src') || ''))
    .map(el => `<div style="display:flex; justify-content:center;">${el.outerHTML.trim()}</div>`);

  const codeBox = document.getElementById('codeOutput');
  const preview = document.getElementById('preview');

  if (urls.length === 0 && youtubeIframes.length === 0) {
    codeBox.textContent = '';
    preview.innerHTML = "<p style='color:#d00'>img 또는 유튜브 iframe을 찾지 못했습니다.</p>";
    return;
  }

  // 3) 이미지 스택 HTML 생성
  const openDiv = '<div style="text-align:center; max-width:100%; margin:0 auto; line-height:0; font-size:0;">';
  const imgTagForOutput = (u) =>
    stripStyles
      ? `<img src="${u}">`
      : `<img src="${u}" style="width:100%; height:auto; display:block; margin:0; padding:0; border:0; vertical-align:top;">`;
  const imgTagForPreview = (u) =>
      `<img src="${u}" style="width:100%; height:auto; display:block; margin:0; padding:0; border:0; vertical-align:top;">`;

  const closeDiv = '</div>';

  // 출력용(복사할 코드): 체크박스에 따라 img style 포함/제거
  const stackHtmlOutput = urls.length ? openDiv + urls.map(imgTagForOutput).join('') + closeDiv : '';

  // 4) 최종 출력: (iframe들) + (이미지 스택)
  const finalHtml = [youtubeIframes.join('\n'), stackHtmlOutput].filter(Boolean).join('\n');

  // 5) 복사용 코드 + 미리보기(미리보기는 항상 스타일 유지)
  codeBox.textContent = finalHtml;
  const previewStack = urls.length ? `<div class="stack-preview">${urls.map(imgTagForPreview).join('')}</div>` : '';
  preview.innerHTML = [youtubeIframes.join(''), previewStack].join('');
}

function copyCode() {
  const code = document.getElementById('codeOutput').textContent.trim();
  if (!code) { alert('복사할 코드가 없습니다. 먼저 추출을 실행하세요.'); return; }
  navigator.clipboard.writeText(code).then(() => alert('코드가 복사되었습니다.'));
}
</script>

</body>
</html>
